#!/usr/bin/python3
# SPDX-FileCopyrightText: 2025 Kaito Yagiuchi
# SPDX-License-Identifier: BSD-3-Clause

import sys
sys.dont_write_bytecode = True
from keys import keys, get_key
import os

def vigenere_encrypt(plaintext, key):
    key = key.lower()
    ciphertext = ""
    key_index = 0
    for char in plaintext:
        if char.isalpha():
            shift = ord(key[key_index % len(key)]) - ord('a')
            base = ord('A') if char.isupper() else ord('a')
            ciphertext += chr((ord(char) - base + shift) % 26 + base)
            key_index += 1
        else:
            ciphertext += char
    return ciphertext

def vigenere_decrypt(ciphertext, key):
    key = key.lower()
    plaintext = ""
    key_index = 0
    for char in ciphertext:
        if char.isalpha():
            shift = ord(key[key_index % len(key)]) - ord('a')
            base = ord('A') if char.isupper() else ord('a')
            plaintext += chr((ord(char) - base - shift) % 26 + base)
            key_index += 1
        else:
            plaintext += char
    return plaintext

def read_alpha_input():
    try:
        raw = input()
    except EOFError:
        sys.exit(2)
    except Exception:
        sys.exit(1)

    line = raw.strip()

    if not line:
        sys.exit(2)
    if not line.isascii():
        sys.exit(3)
    if not all(c.isalpha() or c == ' ' for c in line):
        sys.exit(4)

    return line

if __name__ == "__main__":
    try:
        mode_raw = input()
    except EOFError:
        sys.exit(2)
    except Exception:
        sys.exit(1)

    mode = mode_raw.strip()
    if not mode:
        sys.exit(2)

    if mode == "1":
        test_index = os.environ.get("TEST_KEY_INDEX")
        test_index = int(test_index) if test_index and test_index.isdigit() else None
        index, key = get_key(test_index)

        text = read_alpha_input()
        encrypted = vigenere_encrypt(text, key)

        print(index)
        print(encrypted)
        sys.exit(0)

    elif mode == "2":
        try:
            index_raw = input().strip()
            if not index_raw.isascii():
                sys.exit(5)
            index = int(index_raw)
        except Exception:
            sys.exit(5)

        if not (0 <= index < len(keys)):
            sys.exit(5)

        text = read_alpha_input()
        key = keys[index]

        decrypted = vigenere_decrypt(text, key)
        print(decrypted)
        sys.exit(0)

    else:
        sys.exit(1)
